{% extends 'base.html' %}
{% load static %}
{% block head %}
<link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css" rel="stylesheet" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">

<style>
    .parallax-mirror {
        min-height: 100% !important;
        z-index: 1 !important;
    }
    .hallOfFame{
        animation-timeline: scroll();
        animation-duration: 1ms;
        animation-name: scaleUp;
        animation-timing-function: linear;
    }

    @keyframes scaleUp {
        0% {
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) scale(1);
        }
        100% {
            transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) scale(2);
        }
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="{% static 'src/parallax.min.js' %}"></script>
{% endblock head %}

{% block content %}



<div class="flex flex-col justify-center align-center">
    <div
        style="background-image: url(/media/olympics.jpg); background-attachment: fixed; min-height: 500px; background-position: center; background-repeat:no-repeat; background-size:cover;">
        <h1 style="font-weight: 900; font-style: italic; color: white; -webkit-text-stroke-width: 1px;
  -webkit-text-stroke-color: black;"
            class="hallOfFame text-center self-center text-9xl text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white">
            Hall of <br> <a style="color: black;  text-shadow: 0px 0px 10px rgba(255, 255, 255, 0.37), 0px 0px 5px rgb(255, 255, 255), 0px 0px 34px rgba(0,0,0,0.37);"> Fame </a> </h1>
    </div>

    <div class="flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0 md:space-x-4 p-4">
        <div class="w-full md:w-1/2">
            <form class="flex items-center">
                <label for="simple-search" class="sr-only">Search</label>
                <div class="relative w-full">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor"
                            viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="simple-search"
                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full pl-10 p-2 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                        placeholder="Search" required="">
                </div>
            </form>
        </div>
        <div
            class="w-full md:w-auto flex flex-col md:flex-row space-y-2 md:space-y-0 items-stretch md:items-center justify-end md:space-x-3 flex-shrink-0">
            <div class="flex items-center space-x-3 w-full md:w-auto">
                <button id="sportDropdownButton" data-dropdown-toggle="sportDropdown"
                    class="w-full md:w-auto flex items-center justify-center py-2 px-4 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
                    type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="h-4 w-4 mr-2 text-gray-400"
                        viewbox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"
                            clip-rule="evenodd"></path>
                    </svg>
                    Sport
                    <svg class="-mr-1 ml-1.5 w-5 h-5" fill="currentColor" viewbox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path clip-rule="evenodd" fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z">
                        </path>
                    </svg>
                </button>
                <div id="sportDropdown" class="z-10 hidden w-48 p-3 bg-white rounded-lg shadow dark:bg-gray-700">
                    <ul class="space-y-2 text-sm" aria-labelledby="filterDropdownButton">
                        {% for sport in sports %}
                        <li class="flex items-center">
                            <input type="checkbox" name="sport" value="{{ sport }}" id="{{ sport }}" onchange="update()"
                                class="w-4 mr-1 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                            <label for="{{ sport }}">
                                {{ sport }}
                            </label>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <button id="countryDropdownButton" data-dropdown-toggle="countryDropdown"
                    class="w-full md:w-auto flex items-center justify-center py-2 px-4 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
                    type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" class="h-4 w-4 mr-2 text-gray-400"
                        viewbox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"
                            clip-rule="evenodd"></path>
                    </svg>
                    Country
                    <svg class="-mr-1 ml-1.5 w-5 h-5" fill="currentColor" viewbox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path clip-rule="evenodd" fill-rule="evenodd"
                            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" />
                    </svg>
                </button>
                <div id="countryDropdown" class="z-10 hidden w-48 p-3 bg-white rounded-lg shadow dark:bg-gray-700">
                    <ul class="space-y-2 text-sm" aria-labelledby="filterDropdownButton">
                        {% for country in countries %}
                        <li class="flex items-center">
                            <input type="checkbox" name="country" value="{{ country.0 }}" id="{{ country.0 }}"
                                onchange="update()"
                                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                            <label for="{{ country.0 }}"
                                class="w-full flex flex-row align-center py-2 ms-2 text-sm font-medium text-gray-900 rounded dark:text-gray-300">
                                <img class="h-4 mr-1" src="https://flagsapi.com/{{ country.0 }}/flat/64.png">
                                {{ country.1 }}
                            </label>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

            </div>
        </div>
    </div>
    {# <div class="relative text-center bg-fixed bg-center bg-cover min-w-full min-h-full"
        style="background-image: url({% static 'olympics.jpg' %})">#}
        {# <h1
            class="permanent-marker-regular text-center self-center text-9xl text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
            Hall of <br> Fame </h1>#}
        {# </div>#}
    <div class="grid p-4 mt-5 rounded-lg grid-cols-1 md:grid-cols-3 gap-4 mx-5 md:mx-10" id="grid">
        {# {% for chunk in athletes %}#}
        {# <div class="grid gap-4">#}
            {# {% for athlete in chunk %}#}
            {# <figure class="relative max-w-full hover:shadow-xl">#}
                {# <img class="h-full max-w-full rounded-lg" src="{{ athlete.image }}" alt="">#}
                {# <figcaption#} {#
                    class="absolute px-4 text-lg text-white bottom-1 pb-3 bg-black/30 left-1/2 -translate-x-1/2 rounded-md w-full text-center">
                    #}
                    {# <p class="text-2xl mt-3 figCaptionText" style="text-shadow: 0px 0px 34px rgba(0,0,0,0.37);">{{ athlete.name }}</p>#}
                    {# </figcaption>#}
                    {# </figure>#}
            {# {% endfor %}#}
            {##}
            {# </div>#}
        {# {% endfor %}#}
    </div>
</div>

<script>
    let grid = document.getElementById('grid');

    function divideArray(nums, K) {
        let N = nums.length;
        let ans = [];
        let temp = [];
        for (let i = 0; i < N; i++) {
            temp.push(nums[i]);
            if (((i + 1) % K) === 0) {
                ans.push(temp);
                temp = [];
            }
        }

        ans.push(temp);
        return ans;
    }

    function update() {
        let countries = getChecked('country');
        let sports = getChecked('sport');
        let name = document.getElementById('simple-search').value;
        insert_data(countries, sports, name);
    }

    let inTimeout = null;
    document.getElementById('simple-search').addEventListener('keyup', () => {
        if (inTimeout != null)
            clearTimeout(inTimeout);

        inTimeout = setTimeout(function () {
            update();
        }, 100);
    });

    function insert_data(countries = Array(), sports = Array(), name = '') {
        $.ajax({
            url: "{% url 'athlete_list' %}",
            type: "POST",
            data: {
                csrfmiddlewaretoken: "{{ csrf_token }}",
                country: countries,
                sport: sports,
                name: name
            },
            success: function (data) {
                grid.innerHTML = '';
                data = JSON.parse(data['athletes']);
                let rows;
                if (data.length <= 5) {
                    rows = divideArray(data, 1);
                } else {
                    rows = divideArray(data, 3);
                }
                console.log(rows);
                for (const row in rows) {
                    let div = document.createElement('div');
                    div.classList.add('grid', 'gap-4');
                    for (const athlete in rows[row]) {
                        let figure = document.createElement('figure');
                        figure.classList.add('relative', 'max-w-full');
                        let img = document.createElement('img');
                        img.classList.add('h-full', 'w-auto', 'object-cover', 'rounded-lg', 'hover:-translate-y-2', 'hover:shadow-md', 'hover:shadow-white', 'transition-all');
                        img.src = rows[row][athlete]['fields']['image'];
                        img.alt = '';
                        let figcaption = document.createElement('figcaption');
                        figcaption.classList.add('absolute', 'px-4', 'text-lg', 'text-white', 'bottom-1', 'pb-3', 'bg-black/30', 'left-1/2', '-translate-x-1/2', 'rounded-md', 'w-full', 'text-center');
                        let p = document.createElement('p');
                        p.classList.add('text-2xl', 'mt-3');
                        p.style.cssText += 'text-shadow: 0px 0px 34px rgba(0,0,0,0.37), 0px 0px 5px rgba(0,0,0,1), 0px 0px 34px rgba(0,0,0,0.37);'
                        p.innerHTML = rows[row][athlete]['fields']['name'];
                        figcaption.appendChild(p);

                        let country = document.createElement('img');
                        country.classList.add("absolute", "top-2", "right-3", "h-7", "rounded-lg");
                        country.src = `https://flagsapi.com/${rows[row][athlete]['fields']['country']}/flat/64.png`;

                        figure.appendChild(img);
                        figure.appendChild(figcaption);
                        figure.appendChild(country);
                        div.appendChild(figure);
                    }
                    grid.appendChild(div);
                }
            }
        });
    }

    function getChecked(name) {
        return Array.from(document.querySelectorAll('input[name=' + name + ']:checked')).map(function (el) {
            return el.value;
        });
    }

    insert_data();
</script>

{% endblock content %}